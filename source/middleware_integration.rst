.. _middleware-integration:

*******************************
B. Интеграция с IPTV Middleware
*******************************

Решение MicroPVR по-умолчанию поддерживается системой `Microimpuls IPTV/OTT Middleware Smarty <http://mi-smarty-docs.readthedocs.io/>`_.

Для интеграции MicroPVR со сторонней системой Middleware необходимо использовать :ref:`JSON-RPC API <jsonrpc-api>`.

Формат HTTP URL для доступа к записанному контенту на необходимую позицию времени: ::

    http://<host>:8080/ts?channel_id=<channel_id>&timestamp=<timestamp>&endless=<0|1>&priority=<priority>&aid=<aid>

Описание параметров URL:

- ``channel_id`` - уникальный идентификатор канала, соответствующий тому, который был передан при добавлении задачи на запись.
- ``timestamp`` - время в формате UNIX Timestamp, соответствующее времени начала передачи по EPG по UTC+0.
- ``endless`` - необязательный параметр (по умолчанию отключен), активирующий режим эмуляции "бесконечного" потока.
  Используется для устройств, которые обрывают воспроизведение архивной передачи по достижению момента конца файла
  (например, устройства Samsung и Android).
- ``priority`` - необязательный параметр, если явно указать приоритет, то micropvr отдаст запись с источника соответствующего приоритета.
- ``aid`` - необязательный параметр, идентификатор аккаунта.

Формат HTTP URL для доступа к получения плейлиста заданного типа на заданное время: ::

    http://<host>:8080/pvr/playlist?channel_id=<channel_id>&start_timestamp=<timestamp>&end_timestamp=<timestamp>&aid=<aid>&type=0
    
- ``channel_id`` - уникальный идентификатор канала, соответствующий тому, который был передан при добавлении задачи на запись.
- ``start_timestamp`` - время в формате UNIX Timestamp, соответствующее времени начала передачи по EPG по UTC+0.
- ``end_timestamp`` - время в формате UNIX Timestamp, соответствующее времени окончания передачи по EPG по UTC+0.
- ``type`` - тип плейлиста (на данный момент доступен только тип 0 - HLS с использованием EXT-X-BYTERANGE для сегментирования).
- ``aid`` - необязательный параметр, идентификатор аккаунта.

Прямой доступ к сегментам, записям и плейлистам осуществляется по URL-адресу вида: ::

    http://<host>:8080/pvr/<directory_nickname>/<filename>
